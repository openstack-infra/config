- name: Install upstream kafs copr repos
  command: dnf copr enable -y jsbillings/kafs
  become: true

- name: Load kafs module
  command: modprobe kafs
  become: true

- name: Install kafs packages
  package:
    name:
      - kafs-client
      - kafs-utils
    state: present
  become: true

- name: Configure root cell
  sysctl:
    name: fs.afs.root_cell
    value: '{{ kafs_client_cell }}'
    sysctl_set: yes
    state: present
    reload: yes
  become: true

- name: Mount AFS
  mount:
    path: /afs
    source: none
    fstype: afs
    opts: dyn
    state: present
  become: true