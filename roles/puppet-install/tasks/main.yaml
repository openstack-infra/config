- name: Install puppet packages
  include: "{{ lookup('first_found', params) }}"
  vars:
    params:
      files:
        - "{{ ansible_distribution_release }}.yaml"
        - "{{ ansible_distribution }}.yaml"
        - "{{ ansible_os_family }}.yaml"
        - "default.yaml"
      paths:
        - puppet-install

- name: Install system-config modules
  when: puppet_install_system_config_modules
  become: true
  block:
    - name: Make sure git is installed
      package:
        name: git
        state: present

    - name: Make sure system-config repo is up to date
      git:
        repo: https://git.openstack.org/openstack-infra/system-config
        dest: /opt/system-config/production
        force: yes

    - name: Clone puppet modules to /etc/puppet/modules
      command: ./install_modules.sh
      args:
        chdir: /opt/system-config/production

