- name: Update submodules
  command: git submodule update --init
  args:
    chdir: /home/zuul/src/gerrit.googlesource.com/gerrit

- name: Move plugin repos into gerrit tree
  command: "mv {{ item }} ../gerrit/plugins"
  args:
    chdir: /home/zuul/src/gerrit.googlesource.com/plugins
  loop: &gerrit_plugins
    - its-storyboard
    - its-base
    - javamelody
    - verify-status
    - delete-project
    - importer

- name: Configure plugin bazel file
  lineinfile:
    path: /home/zuul/src/gerrit.googlesource.com/gerrit/tools/bzl/plugins.bzl
    insertafter: "# Add custom core plugins here"
    line: '"{{ item }}",'
  loop: *gerrit_plugins

- name: Configure external plugin deps
  copy:
    force: yes
    src: external_plugin_deps.bzl
    path: /home/zuul/src/gerrit.googlesource.com/gerrit/plugins/external_plugin_deps.bzl
