- job:
    name: puppet-beaker-rspec-infra-system-config
    parent: puppet-beaker-rspec-infra
    vars:
      project_src_dir: "{{ zuul.project.src_dir }}/modules/openstack_project"

- job:
    name: puppet-beaker-rspec-infra-centos-7-system-config
    parent: puppet-beaker-rspec-centos-7-infra
    vars:
      project_src_dir: "{{ zuul.project.src_dir }}/modules/openstack_project"

- job:
    name: puppet-beaker-rspec-puppet-4-infra-system-config
    parent: puppet-beaker-rspec-puppet-4-infra
    vars:
      project_src_dir: "{{ zuul.project.src_dir }}/modules/openstack_project"

- job:
    name: puppet-beaker-rspec-puppet-4-centos-7-infra-system-config
    parent: puppet-beaker-rspec-puppet-4-infra
    vars:
      project_src_dir: "{{ zuul.project.src_dir }}/modules/openstack_project"

# Role integration jobs.  These test the top-level generic roles/*
# under Zuul.  The range of platforms should be the same as those for
# openstack-zuul-jobs.
#
# NOTE(ianw): 2018-08 have left off Fedora & OpenSUSE because
#  no roles currently run on them.
- job:
    name: system-config-zuul-role-integration
    description: |
      Test roles provided by system-config with Zuul
    abstract: true
    parent: base
    run: roles-test/base.yaml
    files:
      - roles/.*

- job:
    name: system-config-zuul-role-integration-multinode
    description: |
      Test roles provided by system-config with Zuul
    abstract: true
    parent: multinode
    run: roles-test/base.yaml
    files:
      - roles/.*

- job:
    name: system-config-zuul-role-integration-centos-7
    parent: system-config-zuul-role-integration
    nodeset: centos-7

- job:
    name: system-config-zuul-role-integration-trusty
    parent: system-config-zuul-role-integration
    nodeset: ubuntu-trusty

- job:
    name: system-config-zuul-role-integration-xenial
    parent: system-config-zuul-role-integration-multinode
    nodeset:
      nodes:
        - name: trusty-puppet3
          label: ubuntu-trusty
        - name: trusty-puppet4
          label: ubuntu-trusty
        - name: xenial-puppet3
          label: ubuntu-xenial
        - name: xenial-puppet4
          label: ubuntu-xenial

- job:
    name: system-config-zuul-role-integration-bionic
    parent: system-config-zuul-role-integration
    nodeset: ubuntu-bionic

- job:
    name: system-config-zuul-role-integration-debian-stable
    parent: system-config-zuul-role-integration
    nodeset: debian-stable

- project-template:
    name: system-config-zuul-role-integration
    check:
      jobs:
#        - system-config-zuul-role-integration-centos-7
#        - system-config-zuul-role-integration-trusty
        - system-config-zuul-role-integration-xenial
#        - system-config-zuul-role-integration-bionic
#        - system-config-zuul-role-integration-debian-stable
    gate:
      jobs:
 #       - system-config-zuul-role-integration-centos-7
 #       - system-config-zuul-role-integration-trusty
        - system-config-zuul-role-integration-xenial
 #       - system-config-zuul-role-integration-bionic
 #       - system-config-zuul-role-integration-debian-stable

- job:
    name: system-config-run-base
    nodeset:
      nodes:
        - name: bridge.openstack.org
          label: ubuntu-bionic
        - name: trusty
          label: ubuntu-trusty
        - name: xenial
          label: ubuntu-xenial
        - name: bionic
          label: ubuntu-bionic
        - name: centos7
          label: centos-7
    host-vars:
      trusty:
        ansible_python_interpreter: python2
      centos7:
        ansible_python_interpreter: python2
    pre-run: playbooks/zuul/run-base-pre.yaml
    run: playbooks/zuul/run-base.yaml
    files:
      - .zuul.yaml
      - playbooks/.*
      - roles/.*
      - testinfra/.*

- project:
    templates:
      - system-config-zuul-role-integration
#    check:
#      jobs:
#        - puppet-beaker-rspec-infra-system-config
#        - puppet-beaker-rspec-infra-centos-7-system-config
#        - puppet-beaker-rspec-puppet-4-infra-system-config
#        - puppet-beaker-rspec-puppet-4-centos-7-infra-system-config
#        - system-config-run-base
#    gate:
#      jobs:
#        - puppet-beaker-rspec-infra-system-config
#        - puppet-beaker-rspec-infra-centos-7-system-config
#        - puppet-beaker-rspec-puppet-4-infra-system-config
#        - puppet-beaker-rspec-puppet-4-centos-7-infra-system-config
#        - system-config-run-base
