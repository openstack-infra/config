- job-template:
    name: 'ci-{name}-unittest'
    node: juniper-tests

    wrappers:
      - contrail-jobs-wrapper

    builders:
      - shell: |
          #!/bin/bash -xe
          export USER=jenkins
          export JOB_NAME="contrail-unittest-job"
          export PROJECT_NAME={name}
          export WORKSPACE=$PWD
          rm -rf $WORKSPACE/* $WORKSPACE/.* || true
          /usr/bin/ci_setup.sh
          ruby /usr/local/jenkins/slave_scripts/contrail-git-prep.rb
          ruby /usr/local/jenkins/slave_scripts/contrail-unittests-job.sh

- job-template:
    name: 'ci-{name}-flake8'
    node: juniper-tests

    wrappers:
      - contrail-jobs-wrapper

    builders:
      - shell: |
          #!/bin/bash -xe
          export USER=jenkins
          export JOB_NAME="contrail-flake8-job"
          export PROJECT_NAME={name}
          export WORKSPACE=$PWD
          rm -rf $WORKSPACE/* $WORKSPACE/.* || true
          /usr/bin/ci_setup.sh
          ruby /usr/local/jenkins/slave_scripts/contrail-git-prep.rb
          [ $PROJECT_NAME = contrail-neutron-plugin ] && bash +x /usr/local/jenkins/slave_scripts/contrail-flake8-job.sh openstack neutron_plugin
          [ $PROJECT_NAME = contrail-nova-vif-driver ] && bash +x /usr/local/jenkins/slave_scripts/contrail-flake8-job.sh openstack nova_contrail_vif
          [ $PROJECT_NAME = contrail-generateDS ] && bash +x /usr/local/jenkins/slave_scripts/contrail-flake8-job.sh tools generateds || exit 0

- job-template:
    name: 'ci-{name}-systest'
    node: juniper-tests

    wrappers:
      - contrail-jobs-wrapper

    builders:
      - shell: |
          #!/bin/bash -xe
          export USER=jenkins
          export JOB_NAME="contrail-systest-job"
          export PROJECT_NAME={name}
          export WORKSPACE=$PWD
          rm -rf $WORKSPACE/* $WORKSPACE/.* || true

          /usr/bin/ci_setup.sh
          ruby /usr/local/jenkins/slave_scripts/contrail-systest-job.rb --nodes 1

- job-template:
    name: 'ci-{name}-devstack'
    node: 'devstack-tests'

    wrappers:
      - contrail-jobs-wrapper

    builders:
      - shell: |
          #!/bin/bash -xe
          export USER=jenkins
          export JOB_NAME="contrail-devstack-job"
          export PROJECT_NAME={name}
          export WORKSPACE=$PWD
          rm -rf $WORKSPACE/* $WORKSPACE/.* || true

          /usr/bin/ci_setup.sh
          ruby /usr/local/jenkins/slave_scripts/contrail-devstack-job.rb

- job-group:
    name: contrail-unittest-jobs
    jobs:
      - 'ci-{name}-unittest'

- job-group:
    name: contrail-flake8-jobs
    jobs:
      - 'ci-{name}-flake8'

- job-group:
    name: contrail-systest-jobs
    jobs:
      - 'ci-{name}-systest'

- job-group:
    name: contrail-devstack-jobs
    jobs:
      - 'ci-{name}-devstack'

