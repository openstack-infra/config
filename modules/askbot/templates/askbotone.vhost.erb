# This needs to be in your server's config somewhere, probably
# the main httpd.conf
# NameVirtualHost *:80

# This line also needs to be in your server's config.
# LoadModule wsgi_module modules/mod_wsgi.so

# You need to manually edit this file to fit your needs.
# This configuration assumes the default installation prefix
# of /opt/askbot/, if you installed askbot somewhere else
# you will need to change all the occurances of /opt/askbot/
# in this file to your chosen install location.

# XXX You need to set this up!
# Read http://code.google.com/p/modwsgi/wiki/ConfigurationDirectives#WSGISocketPrefix
#WSGISocketPrefix /var/run/apache2/wsgi

#<VirtualHost <%= scope.lookupvar("::askbot::deployment::askone_vhost_name") %>:80>
<VirtualHost *:80>
        ServerAdmin <%= scope.lookupvar("::askbot::deployment::serveradmin") %>
        ErrorLog /var/log/apache2/askbotsiteone-error.log
        CustomLog /var/log/apache2/askbotsiteone-access.log common
        LogLevel debug

        Redirect / https://<%= scope.lookupvar("::askbot::deployment::askone_vhost_name") %>/
</VirtualHost>

<IfModule mod_ssl.c>
#<VirtualHost <%= scope.lookupvar("::askbot::deployment::askone_vhost_name") %>:443>
<VirtualHost *:443>
        ServerName <%= scope.lookupvar("::askbot::deployment::askone_vhost_name") %>
        ServerAdmin <%= scope.lookupvar("::askbot::deployment::serveradmin") %>

        DocumentRoot "/opt/askbot/askbotsiteone"
        ErrorLog /var/log/apache2/askbotsiteone-ssl-error.log
        CustomLog /var/log/apache2/askbotsiteone-ssl-access.log common
        LogLevel debug

        SSLEngine on
        SSLCertificateFile <%= scope.lookupvar("::askbot::deployment::ssl_cert_file") %>
        SSLCertificateKeyFile <%= scope.lookupvar("::askbot::deployment::ssl_key_file") %>
        <% if scope.lookupvar("::askbot::deployment::ssl_chain_file") != "" %>
          SSLCertificateChainFile <%= scope.lookupvar("::askbot::deployment::ssl_chain_file") %>
        <% end %>

        #aliases to serve static media directly
        #will probably need adjustment
        Alias /static/ /opt/askbot/askbotsiteone/static/
        Alias /upfiles/ /opt/askbot/askbotsiteone/askbot/upfiles/
        <DirectoryMatch "/opt/askbot/askbotsiteone/askbot/skins/([^/]+)/media">
            Order deny,allow
            Allow from all
        </DirectoryMatch>
        <Directory "/opt/askbot/askbotsiteone/askbot/upfiles">
            Order deny,allow
            Allow from all
        </Directory>

        <Location "/media/">
                SetHandler None
        </Location>
        # XXX In order for the django admin site media to work you
        # must change @DJANGO_ROOT@ to be the path to your django
        # installation, which is probably something like:
        # /usr/lib/python2.6/site-packages/django
        Alias /media/ "/usr/lib/python2.7/dist-packages/django/contrib/admin/media/"

        WSGIDaemonProcess askbotsiteone processes=5 threads=5 display-name='%{GROUP}' inactivity-timeout=120
        WSGIProcessGroup askbotsiteone
        WSGIApplicationGroup %{GLOBAL}
        WSGIScriptAlias / /opt/askbot/askbotsiteone/django.wsgi
</VirtualHost>
</IfModule>
