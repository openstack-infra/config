---
# pyflakes-gate
main:
  name: 'gate-gerritbot-pyflakes'
  review_site: 'review.openstack.org'
  github_org: 'openstack-ci'
  project: 'gerritbot'
  concurrent: 'true'
  timeout: 30
  timeout_fail: true
  timestamps: true

logrotate:
  daysToKeep: 28
  numToKeep: -1
  artifactDaysToKeep: -1
  artifactNumToKeep: -1

triggers:
  - zuul

builders:
  - gerrit_git_prep
  - pyflakes

scm:
  scm: 'false'

assignednode:
  node: 'precise'

---
# pep8-gate
main:
  name: 'gate-gerritbot-pep8'
  review_site: 'review.openstack.org'
  github_org: 'openstack-ci'
  project: 'gerritbot'
  concurrent: 'true'
  timeout: 30
  timeout_fail: true
  timestamps: true

logrotate:
  daysToKeep: 28
  numToKeep: -1
  artifactDaysToKeep: -1
  artifactNumToKeep: -1

triggers:
  - zuul

builders:
  - gerrit_git_prep
  - pep8

post_build_actions:
  - pep8

scm:
  scm: 'false'

assignednode:
  node: 'precise'

---
# merge-gate
main:
  name: 'gate-gerritbot-merge'
  review_site: 'review.openstack.org'
  github_org: 'openstack-ci'
  project: 'gerritbot'
  concurrent: 'true'
  timeout: 30
  timeout_fail: true
  timestamps: true

logrotate:
  daysToKeep: 28
  numToKeep: -1
  artifactDaysToKeep: -1
  artifactNumToKeep: -1

triggers:
  - zuul

builders:
  - gerrit_git_prep

scm:
  scm: 'false'

assignednode:
  node: 'precise'

---
# tarball
main:
  name: 'gerritbot-sdist-tarball'
  review_site: 'review.openstack.org'
  github_org: 'openstack-ci'
  project: 'gerritbot'
  concurrent: 'true'
  timeout: 30
  timeout_fail: true

logrotate:
  daysToKeep: 28
  numToKeep: -1
  artifactDaysToKeep: -1
  artifactNumToKeep: -1

triggers:
  - zuul_post

builders:
  - gerrit_git_prep
  - shell: |
      #!/bin/bash -xe
      BRANCH=$GERRIT_REFNAME
      BRANCH_PATH=`echo $BRANCH | tr / -`

      tox -v -evenv python setup.py sdist
      cp dist/* dist/gerritbot-$BRANCH_PATH.tar.gz

post_build_actions:
  - tarball:
      site: 'ci.openstack.org'
      project: 'gerritbot'

scm:
  scm: 'false'

assignednode:
  node: 'precise'

---
# pypi-upload
main:
  name: 'gerritbot-pypi'
  review_site: 'review.openstack.org'
  github_org: 'openstack-ci'
  project: 'gerritbot'
  concurrent: 'true'
  timeout: 30
  timeout_fail: true

triggers:
  - zuul_post

builders:
  - gerrit_git_prep
  - shell: tox -v -evenv python setup.py sdist upload

post_build_actions:
  - tarball:
      site: 'ci.openstack.org'
      project: 'gerritbot'

scm:
  scm: 'false'

assignednode:
  node: 'pypi'
