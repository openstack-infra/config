---
- name: run puppet
  command: timeout -s 9 30m puppet agent --onetime --ignorecache --no-daemonize --no-usecacheonfailure --no-splay --detailed-exitcodes --verbose
  register: result
  failed_when: "result.rc != 0 and result.rc != 2"
  changed_when: "result.rc == 4 or result.rc == 6"
