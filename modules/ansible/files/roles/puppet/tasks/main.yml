---
- name: run puppet
  puppet:
  register: result
- irc: server={{ puppet_irc_server }} channel={{ puppet_irc_channel }} nick={{ puppet_irc_nick }}
       msg="puppet failed to run on {{ ansible_fqdn }}."
  when: "result.rc == 1 and not result.disabled"
- irc: server={{ puppet_irc_server }} channel={{ puppet_irc_channel }} nick={{ puppet_irc_nick }}
       msg="puppet error on {{ ansible_fqdn }}. {{puppet_base_url}}/report/latest/{{ ansible_fqdn }}"
  when: "result.rc == 4 or result.rc == 6"
- irc: server={{ puppet_irc_server }} channel={{ puppet_irc_channel }} nick={{ puppet_irc_nick }}
       msg="puppet timed out on {{ ansible_fqdn }}."
  when: "result.rc == 124"
