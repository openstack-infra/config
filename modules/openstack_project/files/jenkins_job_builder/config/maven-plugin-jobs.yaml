# usig a freestyle project to work around jenkins bug:
# https://issues.jenkins-ci.org/browse/JENKINS-14193

- job-template:
    name: 'gate-{name}-build'
    node: '{node}'

    wrappers:
      - build-timeout:
          timeout: 30
      - timestamps

    builders:
      - revoke-sudo
      - gerrit-git-prep
      - shell: |
          #!/bin/bash -xe
          /usr/local/jenkins/slave_scripts/version-properties.sh
          source version.properties
          mvn clean package -Dproject-version=$PROJECT_VER

    publishers:
      - console-log

- job-template:
    name: '{name}-localrepo-upload'
    node: '{node}'

    wrappers:
      - build-timeout:
          timeout: 30
      - timestamps

    builders:
      - revoke-sudo
      - gerrit-git-prep
      - shell: |
          #!/bin/bash -xe
          /usr/local/jenkins/slave_scripts/version-properties.sh
          source version.properties
          mvn clean package -Dproject-version=$PROJECT_VER

    publishers:
      - war:
          site: '{tarball-site}'
          warfile: 'target/{name}-*.jar'
          target: 'tarballs/ci/{name}'
      - console-log

- job-template:
    name: '{name}-mavencentral-upload'
    node: pypi

    builders:
      - revoke-sudo
      - shell: |
          /usr/local/jenkins/slave_scripts/artifact-publish.sh \
          -a java-package -p {name}
    publishers:
      - console-log

- job-group:
    name: maven-plugin-jobs
    jobs:
      - 'gate-{name}-build'
      - '{name}-localrepo-upload'
      - '{name}-mavencentral-upload'
