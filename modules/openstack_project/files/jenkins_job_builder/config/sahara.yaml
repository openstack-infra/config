- job-template:
    name: 'sahara-hadoop-swiftfs{release-type}-release'

    builders:
      - gerrit-git-prep
      - shell: |
          #!/bin/bash -xe
          cd hadoop-swiftfs
          /usr/local/jenkins/slave_scripts/version-properties.sh
      - inject:
          properties-file: version.properties
      - shell: |
          #!/bin/bash -xe

          cd hadoop-swiftfs
          mvn package -B
          cd ..

          mkdir dist

          if [ -z "{release-type}" ] ; then
              cp hadoop-swiftfs/target/*.jar dist/hadoop-swiftfs-$PROJECT_VER.jar
          else
              BRANCH=$ZUUL_REFNAME
              BRANCH_PATH=`echo $BRANCH | tr / -`
              cp dist/hadoop-swift-$PROJECT_VER.jar dist/hadoop-swiftfs-$BRANCH_PATH.jar
          fi

    publishers:
      - console-log
          - scp:
              site: 'static.openstack.org'
              files:
                - target: 'tarballs/sahara/hadoop-swiftfs'
                  source: 'dist/*.jar'
                  keep-hierarchy: false
                  copy-after-failure: false

    node: precise
