# This is a non-standard docs job because it uses SCP instead of FTP
- job:
    name: storyboard-docs
    node: precise

    builders:
      - gerrit-git-prep
      - docs:
          github-org: openstack-infra
          project: storyboard

    publishers:
      - scp:
          site: '173.203.107.207'
          files:
            - target: 'ci/storyboard'
              source: 'doc/build/html/**/*'
              keep-hierarchy: true
      - console-log

- job:
    name: gate-storyboard-webclient-unittests
    node: bare-precise

    builders:
      - gerrit-git-prep
      - shell: |
          ./bin/bootstrap.sh
          ./bin/build.sh
    publishers:
      - console-log
      - coverage-log
      - scp:
          site: 'static.openstack.org'
          files:
            - target: 'logs/$LOG_PATH'
              source: 'reports/**'
              keep-hierarchy: true
              copy-after-failure: true

- job-template:
    name: 'storyboard-webclient-release-{branch-designator}'
    node: bare-precise

    builders:
      - gerrit-git-prep
      - shell: |
          ./bin/bootstrap.sh
          ./bin/build.sh
      - shell: |
          #!/bin/bash -xe

          BRANCH={branch-designator}
          ARCHIVE_NAME={name}
          if [ "$BRANCH" != "master" ] ; then
              BRANCH_PATH=`echo $ZUUL_REFNAME | tr / -`
              ARCHIVE_NAME={name}-$BRANCH_PATH
          fi
          tar -czf $ARCHIVE_NAME.tar.gz dist/
          mv $ARCHIVE_NAME.tar.gz dist/
    publishers:
      - console-log
      - coverage-log
      - scp:
          site: 'static.openstack.org'
          files:
            - target: 'logs/$LOG_PATH'
              source: 'reports/**'
              keep-hierarchy: true
              copy-after-failure: true
      - tarball:
          project: '{name}'
          site: '{tarball-site}'