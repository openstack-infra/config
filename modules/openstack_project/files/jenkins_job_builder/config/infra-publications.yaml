# simply copy the contents of the repository to the server, no building needed
- job:
    name: infra-publications-publish
    concurrent: false
    node: precise

    builders:
      - gerrit-git-prep
      - shell: |
          #!/bin/bash -x
          # NAME will either be the branch name or the tag name
          NAME=`echo $ZUUL_REFNAME | sed 's/refs.tags.//'`
          mkdir -p _out/$NAME
          mv * _out/$NAME

    publishers:
      - ftp:
          site: docs.openstack.org
          source: '_out/**'
          target: 'infra/publications/'
          remove-prefix: '_out/'
          excludes: ''
      - console-log

- job:
    name: infra-publications-publish-index
    concurrent: false
    node: precise

    builders:
      - gerrit-git-prep
      - shell: |
          #!/bin/bash -xe
          git reset --hard remotes/origin/master
          git clean -x -f -d -q
          ./make-index

    publishers:
      - ftp:
          site: docs.openstack.org
          source: 'output/**'
          target: 'infra/publications/'
          remove-prefix: 'output/'
          excludes: ''
      - console-log
