- job-template:
    name: '{name}-tox-doc-publish-{envlist}'

    wrappers:
      - timeout:
          timeout: 40
          fail: true
      - timestamps

    builders:
      - gerrit-git-prep
      - tox:
          envlist: '{envlist}'
          github-org: '{github-org}'
          project: '{name}'

    publishers:
      - console-log
      - upload-to-docs-site
      - upload-doc-build-results

    node: '{node}'


# this replaces the old openstack-api-site job in Jenkins
- job:
    name: openstack-api-ref
    concurrent: false
    node: precise

    builders:
      - gerrit-git-prep
      - tox:
          envlist: 'publishdocs-api'
          github-org: 'openstack'
          project: 'api-site'

    publishers:
      - console-log
      - upload-to-api-site
      - upload-doc-build-results


# in zuul/layout.yaml specified to only run against master branch.
# this copies static files from www
- job:
    name: openstack-api-site
    concurrent: false
    node: precise

    builders:
      - gerrit-git-prep

    publishers:
      - ftp:
          site: api.openstack.org
          source: 'www/**'
          target: ''
          remove-prefix: 'www/'
          excludes: ''
      - console-log


- job:
    name: compute-api-v2.0-wadl
    concurrent: false
    node: precise

    builders:
      - gerrit-git-prep
      - shell: /usr/local/jenkins/slave_scripts/run-xmllint.sh openstack-compute-api-2/src/os-compute-2.wadl

    publishers:
      - ftp:
          site: docs.openstack.org
          source: 'target/**'
          target: 'api/openstack-compute/2/wadl/'
          remove-prefix: 'target/'
          excludes: '**/*.xml,**/null*'
      - console-log

