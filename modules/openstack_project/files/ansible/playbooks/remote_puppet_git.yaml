---
- hosts: localhost
  gather_facts: false
  connection: local
  tasks:
  - shell: git ls-remote https://git.openstack.org/openstack-infra/project-config master | cut -f 1
    register: gitsha
- hosts: git0*
  gather_facts: false
  max_fail_percentage: 1
  roles:
    - { role: puppet, puppetmaster: puppetmaster.openstack.org,
        sha: {{ hostvars['localhost']['gitsha']['stdout'] }} }
- hosts: review.openstack.org
  gather_facts: false
  roles:
    - { role: puppet, puppetmaster: puppetmaster.openstack.org,
        sha: {{ hostvars['localhost']['gitsha']['stdout'] }} }
