# ************************************
# Managed by Puppet
# ************************************

<VirtualHost *:80>
  ServerName <%= @srvname %>
  RewriteEngine On
  DocumentRoot <%= @docroot %>
  <Directory <%= @docroot %>>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    AllowOverrideList Redirect RedirectMatch
    Satisfy Any
    Require all granted
  </Directory>
  LogLevel warn
  ErrorLog /var/log/apache2/<%= @srvname %>_error.log
  CustomLog /var/log/apache2/<%= @srvname %>_access.log combined
  ServerSignature Off
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
  ServerName <%= @srvname %>
  RewriteEngine On
  DocumentRoot <%= @docroot %>
  SSLEngine on
  SSLProtocol All -SSLv2 -SSLv3
  # Once the machine is using something to terminate TLS that supports ECDHE
  # then this should be edited to remove the RSA+AESGCM:RSA+AES so that PFS
  # only is guarenteed.
  SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!AES256:!aNULL:!eNULL:!MD5:!DSS:!PSK:!SRP
  SSLHonorCipherOrder on
  SSLCertificateFile /etc/ssl/certs/<%= @srvname %>.pem
  SSLCertificateKeyFile /etc/ssl/private/<%= @srvname %>.key
  SSLCertificateChainFile /etc/ssl/certs/<%= @srvname %>_intermediate.pem
  <Directory <%= @docroot %>>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    AllowOverrideList Redirect RedirectMatch
    Satisfy Any
    Require all granted
  </Directory>
  LogLevel warn
  ErrorLog /var/log/apache2/<%= @srvname %>_error.log
  CustomLog /var/log/apache2/<%= @srvname %>_access.log combined
  ServerSignature Off
</VirtualHost>
</IfModule>
