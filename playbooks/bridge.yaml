- hosts: bridge.openstack.org
  name: "Bridge: configure the bastion host"
  become: true
  roles:
    - pip3
    # Note for production use we expect to take the defaults; unit
    # test jobs override this to test with latest upstream ansible.
    - role: install-ansible
      install_ansible_name: '{{ bridge_ansible_name | default("git+https://github.com/ansible/ansible.git@stable-2.7") }}'
      install_ansible_version: '{{ bridge_ansible_version | default(None) }}'
      install_openstacksdk_name: '{{ bridge_openstacksdk_name | default("openstacksdk") }}'
      install_openstacksdk_version: '{{ bridge_openstacksdk_verison | default("latest") }}'
    - root-keys
    - ansible-cron
    - cloud-launcher-cron
  tasks:
    - name: Allow Zuul to trigger Ansible
      authorized_key:
        state: present
        user: root
        key: "{{ item }}"
      loop:
        - "https://zuul.openstack.org/api/project-ssh-key/openstack-infra/system-config.pub"
        - "https://zuul.openstack.org/api/project-ssh-key/openstack-infra/project-config.pub"
