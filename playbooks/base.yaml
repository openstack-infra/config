- hosts: "!disabled"
  roles:
    - users
    - base-repos

# Run base-server seperately so that the update apt cache handler in base-repos
# fires before we run base-server
- hosts: "!disabled"
  roles:
    - base-server
    - timezone
    - unbound

- hosts: bridge.openstack.org:!disabled
  roles:
    - role: configure-openstacksdk
      vars:
        openstacksdk_config_file: '{{ openstacksdk_config_dir }}/all-clouds.yaml'
        openstacksdk_config_template: clouds/bridge_all_clouds.yaml.j2
    - role: configure-openstacksdk
      vars:
        openstacksdk_config_template: clouds/bridge_clouds.yaml.j2

- hosts: nodepool-launcher:nodepool-builder:!disabled
  strategy: free
  roles:
    - minimal-nodepool
    - configure-openstacksdk

- hosts: "puppet:!disabled"
  roles:
    - puppet-install
    - disable-puppet-agent

- hosts: "!ci-backup:!disabled"
  roles:
    - exim
    - iptables
    - snmpd
