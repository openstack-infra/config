- hosts: "localhost"
  name: "Setup test project data"
  vars:
    projects:
      - project: opendev/base-jobs
        description: Zuul configuration common to all OpenDev tenants
  tasks:
    - name: Create test project-config directory
      file:
        path: "/opt/project-config/gerrit/"
        state: directory
    - name: Write test project configuration
      copy:
        dest: "/opt/project-config/gerrit/projects.yaml"
        content: "{{ projects }}"  
  
- hosts: "gitea"
  name: "Create repos on gitea servers"
  strategy: free
  max_fail_percentage: 1
  roles:
    - role: gitea-git-repos

- hosts: "gitea"
  tasks:
    - name: Test project was created in gitea
      uri:
        url: "https://localhost:3000/opendev/base-jobs"
        validate_certs: false
        status_code: 200
